.dashboard.scene
  .banner
    %h1 DEF CON CTF 2013
    %p You're #{current_team.name}
    %br.clear
  .howto
    :markdown
      # Scoreboard

      The scoreboard is visible at [#{scoreboard_path}](#{scoreboard_path}).
      The columns are:

      * SLA: the percentage of availability checks we've made that have succeeded.
      * Flags: the number of flags that haven't been made available for capture.
        This column has two colors; the dark crimson portion is ones that are
        available to capture, and the pink band represents queued flags.
      * Total: SLA Ã— Flags.

      # Scoring

      Hack services, retrieve tokens. Redeem tokens for flags.

      Token redemption is done via a signed HTTPS POST request to
      [#{redemption_path}](#{redemption_path}).

          curl \
            -F "token[]=TOKEN_GOES_HERE" \
            -F "token[]=ANOTHER_TOKEN_GOES_HERE" \
            --cacert legitbs2013.crt \
            -E #{current_team.certname}.crt \
            --key #{current_team.certname}.key \
            #{redemption_url}

      The response body is a JSON object describing what happened with each
      token:

          {
            "valid token": "442f3a75-fd29-4f58-a22a-30032c47bf9b",
            "invalid token": "error: Token doesn't exist",
            "the same valid token": "error: Already redeemed that token",
            "old valid token": "error: Token too old",
            "call legitbs if you see": "error: some other error 79f21e3d-fcef-4327-8d50-dbe78ca8f147" 
          }
  .status
    %h1 Service Status
    %table
      %thead
        %th service
        %th -15m
        %th -10m
        %th -5m
        %th now
      %tbody
        - %w{ beans potatoes tacos gravy cheeseburger coke gasoline vindsl }.each do |s|
          %tr
            %th{rowspan: 2}&= s
            - 4.times do
              - if rand() > 0.5
                %td.ok OK
              - else
                %td.down DOWN
          %tr
            - 4.times do
              - if rand() > 0.5
                %td.safe SAFE
              - else
                %td.owned OWNED
